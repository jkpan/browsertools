<!DOCTYPE html>
<script type="text/javascript" src="../login.js" charset="UTF-8"></script>
<script type="text/javascript" src="../common.js" charset="UTF-8"></script>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <link rel="stylesheet" href="../ui_green.css" />
    <style>
        body {
            margin: 10px;
        }

        .uploadzone {
            width: 90%;
            /*border: 2px dashed #ffffff;*/
            border: none;
            border-radius: 5px;
            text-align: center;
            line-height: 30px;
            color: #ffffff;
            margin: 10px;

            display: none;
            /* display: flex;*/
            /* 啟用 Flexbox 佈局 */
            /* flex-wrap: nowrap; 讓子元素在一行內排列，不換行 */
            /* 或者使用 flex-wrap: wrap; 讓子元素可以自動換行 */
            gap: 10px;
            /* 設定子元素之間的間距 */

        }

        .drop-zone {
            position: relative;
            width: 72px;
            height: 100px;
            border: 2px dashed #ffffff;
            border-radius: 5px;
            text-align: center;
            line-height: 30px;
            color: #ffffff;
            font-family: sans-serif;
            margin: 10px;
        }

        .imgbtn {
            width: 100px;
            height: 100px
        }

        .top-right-button {
            position: absolute;
            top: 0px;
            right: 0px;
            background-color: red;
            border: none;
            padding: 2px 2px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
    </style>
    <title>Song editor</title>
</head>

<body>
    <br>
    <div id="tag"></div>
    <p></p>
    <button id="setedit" style="background-color: rgb(0, 80, 0);" onclick="setEditable()" hidden="true">編輯資料庫</button>
    <div id="prefixdiv" style="margin: 1%;" hidden="true">
        <br>
        <label style="color: rgb(0, 255, 0);">前綴: </label>
        <input type="text" id="prefix">
        <p></p>
        <label style="color: rgb(0, 255, 0);">名稱: </label>
        <input type="text" id="cataname">
        <p></p>
        <button style="background-color: rgb(0, 80, 0);" onclick="cataGo()">新增分類</button>
    </div>

    <hr size="4" align="left" width="60%" color="#00aa00">
    <button onclick="openAllTxt()" style="font-size: 20px;">全文檢索</button>
    <p></p>

    <div id="upload" class="uploadzone">
        <button onclick="downloadFile()">下载</button>
        <input id="allfile" type="file" name="file" accept="image/*" hidden="true" onchange="selectFile(event)" />
        <!-- <div class="drop-zone" id="drop-zone-1" onclick="openFile('allfile', 1)"></div> -->
    </div>

    <script>

        const MAXSHEET = 5;
        var sel_song_id = null;

        const sheetDiv = document.getElementById('upload');
        var currentidx = 0;
        var sheetArray = null;
        var doUpload = false;

        async function downloadURL(url, filename) {
            try {
                const resp = await fetch(url, { mode: 'cors' }); // 可能會因 CORS 被拒
                if (!resp.ok) throw new Error('fetch fail: ' + resp.status);
                const blob = await resp.blob();
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(a.href);
            } catch (e) {
                console.error('下載失敗', url, e);
                // 若 fetch 失敗，嘗試用 img.src 作為備援（可能開新分頁）
                const a = document.createElement('a');
                a.href = url;
                a.target = '_blank';
                a.click();
                a.remove();
            }
        }

        function downloadFile() {
            //const imgs = document.querySelectorAll('img.to-download');
            sheetArray.forEach((element, idx) => {
                const src = element;
                const ext = (src.split('.').pop().split(/\#|\?/)[0]);// || 'jpg';
                const name = `sheet-${idx}.${ext}`;
                downloadURL(src, name);
            });
        }

        function getSheetArray() {
            return sheetArray;
        }

        function getUrl() {
            //window.location.href;
            //window.location.origin
            //window.location.pathname
            let songid = document.getElementById("song_id").value;
            if (songid.trim().length == 0) {
                alert('id?');
                return;
            }
            let url = window.location.origin + window.location.pathname + '?sid=' + songid;
            copyToBoard(url);
            //alert(url);
        }

        function sheetActive(active) {
            if (active)
                sheetDiv.style.display = 'flex';
            else
                sheetDiv.style.display = 'none';
        }

        function isSheetActive() {
            return !(sheetDiv.style.display == 'none');
        }

        function cleanSheetZone() {
            for (let i = 1; i <= MAXSHEET; i++) {
                let div = document.getElementById('drop-zone-' + i);
                if (doUpload)
                    div.innerHTML = '+';
                div.style.backgroundColor = 'transparent';
            }
        }

        function createSheetZone() {
            for (let i = 1; i <= MAXSHEET; i++) {
                let div = document.createElement('div');
                div.id = 'drop-zone-' + i;
                div.className = 'drop-zone';

                //div.onclick = `openFile('allfile', ${i})`;

                if (doUpload) {
                    div.addEventListener("click", (e) => {
                        openFile('allfile', i);
                    });
                    div.addEventListener('drop', (e) => {
                        currentidx = i;
                        e.preventDefault();
                        const files = e.dataTransfer.files;
                        uploadFiles(files);
                    });
                    div.addEventListener('dragover', (e) => { e.preventDefault(); });
                    div.addEventListener('dragleave', () => { });
                }


                sheetDiv.appendChild(div);
            }

        }

        function openFile(elmid, idx) {
            let songid = document.getElementById("song_id").value;
            if (songid.trim().length == 0) {
                alert('id?');
                return;
            }
            currentidx = idx;
            if (document.getElementById('drop-zone-' + idx).innerHTML.trim() === '+') {
                document.getElementById(elmid).click();
            }
        }

        function selectFile(event) { //let file = event.target.files[0]; uploadFiles(files)
            let files = event.target.files;
            uploadFiles(files);
        }

        function _upload(file, songid, songname) {

            //document.getElementById("prog").value = 0;

            let ext = getImageExt(file.name);
            if (!ext) {
                if (file.name.toLowerCase().endsWith('.pdf')) {
                    ext = '.pdf';
                } else {
                    alert('要是圖檔或是PDF');
                    return;
                }
            }

            const formData = new FormData();
            formData.append('file', file, songid + '__' + currentidx + '__' + songname + ext);

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/uploadsheet');

            xhr.upload.onprogress = function (e) {
                if (e.lengthComputable) {
                    const percent = (e.loaded / e.total) * 100;
                    //msg.innerText = percent.toFixed(1) + '%';
                    document.getElementById('drop-zone-' + currentidx).innerHTML = percent.toFixed(1) + '%';
                }
            };

            xhr.onload = function (e) {
                if (xhr.status === 200) {
                    document.getElementById('drop-zone-' + currentidx).innerHTML = '完成';
                    //alert('listSongSheet!');
                    listSongSheet();
                    //msg.innerText = '完成';
                    //list
                    //document.getElementById("prog").value = 0;
                } else {
                    document.getElementById('drop-zone-' + currentidx).innerHTML = '失敗';
                    //msg.innerText = '失敗';
                    //document.getElementById("prog").value = 0;
                    alert('e:' + e);
                }
                //filename.innerText = '';
            };

            xhr.send(formData);
        }

        function uploadFiles(files) {
            let songid = document.getElementById("song_id").value;
            if (songid.trim().length == 0) {
                alert('id?');
                return;
            }
            let songname = getNameFromAll(songid);
            if (!songname) {
                let newsong = parseText();
                if (newsong.length == 0) {
                    alert('name?');
                    return;
                }
                songname = newsong[0][0];
            }

            const formData = new FormData();
            for (const file of files) {
                _upload(file, songid, songname);
            }
        }

        function deleteFile(prefix) {
            _ajax({
                action: "delfile",
                p1: prefix,
                user: null
            },
                '/sheetaction',
                (res) => {
                    //document.getElementById('reload').click();// location.reload();
                    //if (activeFolder.trim().length == 0) return;
                    //listFiles(activeFolder);
                    listSongSheet();
                }, (err) => {
                    alert('del fail');
                });
        }

        function listSongSheet() {
            cleanSheetZone();
            sheetActive(true);
            sheetArray = [];
            sel_song_id = null;
            let songid = document.getElementById("song_id").value;
            if (songid.trim().length == 0) {
                alert('id?');
                return;
            }
            sel_song_id = songid.trim();
            _ajax({
                action: "listbysongid",
                p1: songid,
                user: null
            }, '/sheetaction',
                (obj) => {
                    console.log(JSON.stringify(obj));
                    cleanSheetZone();
                    //div.innerHTML = "";
                    let array = obj['files'];
                    array.sort(); //array.reverse();
                    array.forEach(element => {
                        //let src = encodeURIComponent(element);
                        //let encodedString = URLEncoder.encode(element, "UTF-8");
                        try {
                            let array = element.split('__');
                            let idx = parseInt(array[1]);//array[0];
                            let div = document.getElementById('drop-zone-' + idx);
                            div.innerHTML = '';
                            div.style.backgroundColor = 'transparent';
                            if (isImageFile(element)) {
                                let img = createImage('.' + obj.folder, element);//img.id = 'img_' + idx;
                                sheetArray.push(img.src);
                                div.appendChild(img);
                                if (doUpload)
                                    div.appendChild(createDelButton(idx));
                            } else if (element.toLowerCase().endsWith('.pdf')) {
                                let src = '.' + obj.folder + '/' + element;
                                let img = createPDFBtn(element);//('.' + obj.folder, element);img.id = 'img_' + idx;
                                sheetArray.push(src);
                                div.appendChild(img);
                                if (doUpload)
                                    div.appendChild(createDelButton(idx));
                            }
                        } catch (err) {
                            alert(err);
                            return;
                        }
                    });
                },
                (err) => {
                    alert('list files fail: ' + err);
                });
        }

        function createDelButton(idx) {
            const btn = document.createElement('button');
            btn.className = 'top-right-button';
            btn.innerText = 'x';
            btn.style.width = '30%';
            btn.style.height = '20%';

            btn.addEventListener("click", (e) => {
                if (sel_song_id == null) return;
                if (confirm("確定要刪除?"))
                    deleteFile(sel_song_id + '__' + idx + '__');
            });
            return btn;
        }

        function createPDFBtn(fn) {

            var button = document.createElement('div');
            button.innerHTML = '<br>PDF'
            button.style.fontSize = '14px'; // setting the font size to 20px
            //button.title = fn;
            button.style.background = '#B00';
            button.style.color = '#fff';
            button.style.width = "100%";//width;   // 固定寬度
            button.style.height = "100%";//height; // 固定高度
            button.style.textAlign = 'center';

            button.onclick = function () {
                window.open("./lyrics_sheet_slide.html?idx=" + encodeURI(fn), "_blank");
                return false;
            };
            return button;
        }

        function createImage(path, fn) {

            //const btn = createBigButton(); // btn.style.border = '2px solid';
            const img = document.createElement('img');

            //const uniqueParam = Date.now(); // Using a timestamp for uniqueness
            // Set the image source with the unique query parameter
            //img.src = 'path/to/your/image.png?' + uniqueParam;
            img.src = path + '/' + fn;// + '?t=' + uniqueParam;
            img.title = fn;
            img.style.width = "100%";//width;   // 固定寬度
            img.style.height = "100%";//height; // 固定高度

            // 讓圖片在固定框內保持比例
            img.style.objectFit = 'contain';  // 或 'cover'

            img.addEventListener("click", (e) => {
                //console.log(fn + ' ===== ' + encodeURI(fn));
                //let array = fn.split('__');
                //let idx = parseInt(array[1]);//array[0];

                window.open("./lyrics_sheet_slide.html?idx=" + encodeURI(fn), "_blank");
                //window.open(img.src, "_blank", "width=800,height=600");
            });

            //img.addEventListener("dblclick", (e) => {  alert('dblclick'); });

            return img;
        }



    </script>

    <p></p>

    <div style="margin: 1%;">
        <div id="song_id_div" hidden="true">
            <label style="color: rgb(0, 255, 0);">ID: </label>
            <input id="song_id" type="text"
                style="font-size: 20px; border: 2px solid rgb(0, 128, 0);background-color: rgb(0,255,0);">
        </div>
        <a href="javascript:getUrl()">copy url</a>
        <p></p>
        <textarea id="songtxt" rows="10"></textarea>
        ||<button id="addsong" style="background-color: magenta;" onclick="add2List()" hidden="true">歌單新增/修改</button>||
        <p></p>
        <div id="editdiv" hidden="true">
            <button style="background-color: rgb(0, 80, 0);" onclick="textGo()">加歌 / 修改</button>
            <p></p>
            <button onclick="clearTxt()">清除</button>
            <p></p>
            <button style="width: 10%;color: white;background-color: red;" onclick="delGo()">刪除</button>
        </div>
    </div>
    <p></p>
    <hr size="4" align="left" width="60%" color="#00aa00">

    <script type="text/javascript" charset="UTF-8">

        var cata = [];

        function setEditable() {
            document.getElementById("setedit").hidden = true;
            document.getElementById("prefixdiv").hidden = false;
            document.getElementById("editdiv").hidden = false;

            document.getElementById("song_id_div").hidden = false; //document.getElementById("song_id").hidden = false;
        }

        function clearTxt() {
            document.getElementById("song_id").value = "";
            document.getElementById("songtxt").value = "";
        }

        function delGo() {
            let id_value = document.getElementById("song_id").value;
            if (id_value.length == 0) return;
            if (ALL_SONGS_JSON[id_value]) {
                if (confirm("確定要刪除 '" + id_value + "' ?"))
                    ajax_action('del', id_value, []);
            }

        }

        function cataGo() {

            let prefix_value = document.getElementById("prefix").value;
            if (prefix_value.trim().length == 0) return;

            let cataname_value = document.getElementById("cataname").value;
            cataname_value = cataname_value.trim();
            if (cataname_value.length == 0) return;

            for (let i = 0; i < cata.length; i++) {
                if (cata[i][0] == prefix_value) {
                    alert(prefix_value + ' exist!');
                    return;
                }
            }

            /* 
            cata.forEach((volume, index) => {
                if (volume[0] == prefix_value) {
                    alert(prefix_value + ' exist!');
                    return;
                }
            });
            */

            ajax_action('addCata', prefix_value,
                [prefix_value,
                    1000,
                    false,
                    cataname_value]);
        }

        function parseText() {

            let value = document.getElementById("songtxt").value;
            value = value.trim();
            if (value.length == 0) return;
            let lines = value.split('\n');

            let newsong = [['']];
            let phaseidx = 0;
            let lineidx = 0;
            let preline = '';

            // 逐行处理内容
            lines.forEach((line, index) => {

                line = line.trim();

                if (line.length == 0) {
                    if (preline == '') return;
                    phaseidx++;
                    lineidx = 0;
                    if (index < lines.length - 1) {//不是最後一行
                        newsong[phaseidx] = [''];
                    }
                    preline = '';
                    return;
                }

                newsong[phaseidx][lineidx] = line;
                lineidx++;
                preline = line;

            });

            if (newsong.length == 0) return null;

            return newsong;

        }

        function add2List() {
            let newsong = parseText();
            if (newsong == null) return;

            let idx = window.opener.checkSongName(newsong);

            if (idx > 0) {
                if (!confirm("蓋掉'" + newsong[0][0] + "'? (取消會加進最後)")) {
                    idx = 0;
                }
            }

            window.opener.add2List(newsong, idx);

        }

        function textGo() {

            let newsong = parseText();
            if (newsong == null) return;

            let id_value = document.getElementById("song_id").value;
            id_value = id_value.trim();
            if (id_value.length == 0) return;

            if (ALL_SONGS_JSON[id_value]) {
                if (confirm("確定要修改 '" + id_value + "' ?"))
                    ajax_action('fix', id_value, newsong);
            } else {
                if (confirm("確定要新增 '" + id_value + "' ?"))
                    ajax_action('add', id_value, newsong);
            }
        }

        document.getElementById('song_id').addEventListener('input', (event) => {
            if (isSheetActive()) sheetActive(false);
        });

    </script>
    <br />
</body>

</html>

<script type="text/javascript" charset="UTF-8">

    var allSelector = null;

    function closeSelector() {
        if (allSelector)
            allSelector.close();
        allSelector = null;
    }

    function openAllTxt() {
        closeSelector();
        allSelector = window.open("lyrics_text.html", "_blank", 'width=800, height=600, left=100, top=100');
    }

    function pushSong(songid) {
        clickSong(songid);
    }

    function _ajax(json, url, cb, errorcb) {
        console.log(json);
        fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(json)
        }).then((response) => {
            if (response.ok) {
                return response.json(); // 解析JSON回應
            } else {
                throw new Error("請求失敗：" + response.status);
            }
        }).then((data) => {
            // 在這裡處理解析後的JSON物件 //console.log(data);
            cb(data);
        }).catch((error) => {
            // 處理錯誤
            console.log('' + error);
            errorcb();
        });
    }

    //控方上傳目前
    async function ajax_action(action, id, content) {
        let result = await doChk();

        if (result.state <= 0) {
            alert('需要登入');
            return;
        }

        if (result.username == 'guest' && result.state == 2) {
            alert(esult.username + ' 權限不足');
            return;
        }

        let user = result.username;

        console.log('action:' + action + ', id:' + id + ', ' + JSON.stringify(content));
        _ajax({
            action: action,
            id: id,
            song: content,
            user: user
        },
            '/actionlyrics',
            (res) => {
                console.log(JSON.stringify(res));
                alert('done');
                location.reload();
            }, () => {
                console.log('exception');
            });
    }

    var ALL_SONGS_JSON;

    function _createEmptyBtn() {
        var button = document.createElement('button');
        //button.innerHTML = ' <br/> ';
        button.style.width = '172px'; // setting the width to 200px
        button.style.height = '25px'; // setting the height to 200px
        //button.style.background = 'teal'; // setting the background color to teal
        //button.style.color = 'white'; // setting the color to white
        button.style.fontSize = '14px'; // setting the font size to 20px
        //document.body.appendChild(button);
        return button;
    }

    function mapping(array) {
        let area = document.getElementById("songtxt");
        area.value = '';
        let txt = '';
        array.forEach((p, index) => {
            p.forEach((line, index) => {
                txt += line + '\n';
            });
            txt += '\n';
        });
        area.value = txt;
    }

    function _createBtn(idtxt, attr) {
        var button = document.createElement('button');
        button.innerHTML = idtxt + '<br/>' + attr;// + ' ' + getSong(idtxt)[0][0];
        button.id = 'btn' + idtxt;

        button.style.width = '172px'; // setting the width to 200px
        button.style.height = '64px'; // setting the height to 200px
        //button.style.background = 'rgb(0,100,0)'; // setting the background color to teal
        //button.style.color = 'rgb(0,255,0)'; // setting the color to white
        button.style.fontSize = '14px'; // setting the font size to 20px

        button.onclick = function () {

            clickSong(idtxt);
            return false;

            /*
            let array = ALL_SONGS_JSON[idtxt].content;
            if (!array) return false;

            let field = document.getElementById("song_id");
            field.value = idtxt;
            mapping(array);

            window.scrollTo(0, 0);

            return false;
            */
        };
        return button;
    }

    function getNameFromAll(idtxt) {
        let array = getSongFromAll(idtxt);
        if (!array) return null;
        if (array.length == 0) return null;
        return array[0][0];
    }

    function getSongFromAll(idtxt) {
        let obj = ALL_SONGS_JSON[idtxt];
        if (!obj) return null;
        let array = ALL_SONGS_JSON[idtxt].content;
        if (!array) return null;
        return array;
    }

    function clickSong(idtxt) {
        let array = getSongFromAll(idtxt);// ALL_SONGS_JSON[idtxt].content;
        if (!array) return false;

        let field = document.getElementById("song_id");
        field.value = idtxt;
        mapping(array);

        window.scrollTo(0, 0);

        listSongSheet();
    }

    /*
    function pushSong(songid) {
        console.log('pushSong: ' + songid);
        let allsongs = ALL_SONGS_JSON;//window.opener.ALL_SONGS_JSON;
        var exist = allsongs[songid];
        console.log(exist);
        if (exist) {

            mapping(exist['content']);
        }
    }
    */

    function _songBtn(id) {
        let allsongs = ALL_SONGS_JSON;
        var exist = allsongs[id];
        var btn;
        if (exist) {
            //console.log(JSON.stringify(exist));
            var attr = exist['content'][0][0];
            if (!attr || attr == id) attr = ''
            btn = _createBtn(id, attr);
        } else {
            btn = _createEmptyBtn();
        }
        return btn;
    }

    function createBtns() {

        var div = document.createElement('div');
        div.id = 'btns';
        document.body.appendChild(div);

        let VOLUME = ALL_SONGS_JSON['nosong']['VOLUME']['content'];// window.opener.getSong('VOLUME');

        cata = VOLUME;

        for (let pf = 0; pf < VOLUME.length; pf++) {

            const link = document.createElement('a');
            link.href = '#tag_' + VOLUME[pf][3];
            link.textContent = '[' + VOLUME[pf][3] + ']';
            document.getElementById('tag').appendChild(link);
            document.getElementById('tag').appendChild(document.createTextNode(' '));

            var span = document.createElement('span');
            span.style.color = 'rgb(0,255,0)' // apply your style

            let tag = document.createTextNode(VOLUME[pf][3]);
            //tag.id = 'tag_' + VOLUME[pf][3];
            span.appendChild(tag);
            span.id = 'tag_' + VOLUME[pf][3];

            div.appendChild(span);
            div.insertAdjacentHTML('beforeend', '<p></p>');
            for (var i = 1; i <= VOLUME[pf][1]; i++) {
                var btn = _songBtn(VOLUME[pf][0] + i);
                if (pf % 2 == 0) {
                    btn.style.background = '#005500';//window.opener.COLORS_CK[0]; // setting the background color to teal
                } else {
                    btn.style.background = '#333333';
                }
                if (btn.innerHTML.length > 0 || VOLUME[pf][2]) {
                    //console.log('btn.innerHTML.length : ' + btn.innerHTML.length);
                    //console.log('VOLUME[pf][2] : ' + VOLUME[pf][2]);
                    div.appendChild(btn);
                }
            }

            div.insertAdjacentHTML('beforeend', '<p></p>');
        }

        try {

            let EVENTS = ALL_SONGS_JSON['nosong']['EVENTS']['content'];

            for (let pf = 0; pf < EVENTS.length; pf++) {

                var span = document.createElement('span');
                span.style.color = 'rgb(0,255,0)' // apply your style
                span.appendChild(document.createTextNode(EVENTS[pf]));
                div.appendChild(span);
                div.insertAdjacentHTML('beforeend', '<p></p>');

                let toolList = ALL_SONGS_JSON['nosong'][EVENTS[pf]].content;

                for (let i = 0; i < toolList.length; i++) {
                    var btn = _songBtn(toolList[i]);
                    btn.style.background = '#777777';
                    div.appendChild(btn);
                }

                div.insertAdjacentHTML('beforeend', '<p></p>');
            }

        } catch (error) {
            console.log(error);
        }



    }

    //抓取預設歌庫
    async function fetchData() {
        try {

            const response = await fetch("../users/songbase.json"); // 等待 fetch 请求完成 ./users/songbase.json
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            ALL_SONGS_JSON = await response.json(); // 等待 JSON 解析完成
            //console.log(JSON.stringify(ALL_SONGS_JSON)); // 处理数据
            //return data; // 如果需要同步效果，可以返回数据
        } catch (error) {
            console.error('Failed to fetch JSON:', error);
        }
        console.log('fetchData END');
    }

    (async function () {

        let result = await doChk();
        let user = result.username;

        if (readParam('action') == 'edit') { //編輯模式
            if (result.state <= 0 || (result.username == 'guest' && result.state == 2)) { //權限不足

            } else { //全部權限
                doUpload = true;
                document.getElementById("prefixdiv").hidden = false;
                document.getElementById("song_id_div").hidden = false;
                document.getElementById("editdiv").hidden = false;
            }
        }

        if (window.opener) {
            document.getElementById('addsong').hidden = false;
            const current = window.opener.getCurrentSong();
            if (current) mapping(current);
        }

        await fetchData();
        createBtns();

        createSheetZone();
        cleanSheetZone();
        sheetActive(false);

        if (readParam('sid')) {
            let sid = readParam('sid');
            clickSong(sid);
        }



        /*
        console.log('get content from list');
        if (window.opener) {

            console.log('window.opener exist!');

            document.getElementById('addsong').hidden = false;
            document.getElementById("prefixdiv").hidden = true;
            document.getElementById("editdiv").hidden = true;
            document.getElementById("setedit").hidden = false;

            document.getElementById("song_id_label").hidden = true;
            document.getElementById("song_id").hidden = true;//style.visibility = 'hidden';

        } else {
            
            
        }
        */

    })();


    //"addsong" 歌單新增/修改
    //"editdiv" 



</script>