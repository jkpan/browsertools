
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
      body {
        margin: 0px;
        height: 100%;
        background-color:green
        /*cursor:none;*/
      }
      main {
        position: fixed;
        width: 100%;
        height: 100%;
      }
      ::-webkit-scrollbar {
        display: none;
      }
      hr {
        border: 4px solid #00ff00;
      }
    </style>
    </head>   
<body>

  <canvas id="canvas" width="100" height="100"></canvas>

</body>

</html>

<script type="text/javascript" charset="UTF-8">

var canvas;
var ctx;

var c_obj;

//var pre = 0;
var scale = 1.0;//1.0/2.0;

//var particles = [];

function init() {
    
    canvas = document.getElementById("canvas");
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;
    ctx = canvas.getContext("2d");
}

function anim_update(elapse) {

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'green'; 
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  //if (img) ctx.drawImage(img,0,0, canvas.width, canvas.height);

  //let dt = elapse - pre;
  //pre = elapse;

  if (scale < 0) return;


  //transform
  let _scale = scale;
  let _gap = (1-_scale) * canvas.width + (scale < 1.0?
                                         _scale * (canvas.width - canvas.height)/2:0);
                                          //:0; 

  ctx.transform(_scale, 
                  0, 
                          0,      
                          _scale, 
                                    _gap, 
                                    (1-_scale) * canvas.height);
  //xscale, xskew, yscale, yskew, xoffset, yoffset

  c_obj.update(canvas, ctx);

  ctx.resetTransform();

  window.requestAnimationFrame(anim_update);

}

//function randomPickAnim() { let idx = Math.floor(Math.random() * 5); initAnim(idx);}

function initAnim() {

  if (!c_obj) {
    c_obj = new ClockObj();
    c_obj.initial(canvas);
    console.log('new Clock');
  }

  window.requestAnimationFrame(anim_update);

}

class ClockObj {

  fontColor = "rgb(180, 180, 180)";
  bgColor = "rgba(0, 0, 0, 0.5)";
  frequence = -1;
  
  constructor() {

  }

  release() { }
  initial(c) { }

  changeFreq() {
    switch(this.frequence) {
        case -1: this.frequence = 5; break;
        case 5:  this.frequence = 4; break;
        case 4:  this.frequence = 3; break;
        case 3:  this.frequence = 0.5; break;
        case 0.5: this.frequence = -1; break;
      }
  }

  update(c, _ctx) {

      let x = c.width/2.0;
      let y = c.height/2.0;
      let len = c.height/5.0;
      let lw = c.height/22;

      let date = new Date();

      let h = date.getHours();
      let min = date.getMinutes();
      let s = date.getSeconds();
      let ms = date.getMilliseconds();

      _ctx.strokeStyle = this.fontColor;
      _ctx.fillStyle =  this.bgColor;
      _ctx.lineWidth = lw;
      _ctx.beginPath();
      _ctx.arc(x, y, 2 * len + 10, 0, 2 * Math.PI, true);
      _ctx.fill();
      _ctx.stroke();
      _ctx.closePath();

      _ctx.fillStyle = this.fontColor;
      for (let i = 0;i<12;i++) {
        let angle = (90 - i * 360.0/12.0) * Math.PI/180;
        let dx = 2 * len * Math.cos(angle);
        let dy = -2 * len * Math.sin(angle);
        _ctx.beginPath();
        _ctx.arc(x + dx, y + dy, lw/1.5, 0, 2 * Math.PI, true);
        _ctx.fill();
        _ctx.closePath();
      }

      
      //_ctx.fillStyle = "rgb(100,100,100)" //if (Math.random() > 0.5) 
      //
      let _time = (h<10?'0'+h:h) + ':' + 
                  (min<10?'0'+min:min) +':' + 
                  (s<10?'0'+s:s);
      let _date = date.getFullYear() + '/' + 
                  (date.getMonth() + 1) +'/' + 
                  date.getDate();
      
      let fs = c.width/16;
      _ctx.font = fs + "px Monospace";

      _ctx.fillStyle = 'rgb(0,64,0)';

      _ctx.lineWidth = Math.ceil(fs/14.0);
      _ctx.strokeStyle = this.fontColor;

      _ctx.strokeText(_time, fs, fs);      
      _ctx.fillText(_time, fs, fs);

      _ctx.font = (fs/1.5) + "px Monospace";

      _ctx.strokeText(_date, fs, fs + fs/1.5);
      _ctx.fillText(  _date, fs, fs + fs/1.5);


      /*
      ctx.strokeStyle = 'black';
      ctx.lineWidth = Math.ceil(fontsize/12.0);//ctx.lineWidth = 4;
      ctx.strokeText(txt, x, y);

      ctx.fillStyle = 'white';
      ctx.lineWidth = 1;
      ctx.fillText(txt, x, y);
      */
      /*
      _ctx.textAlign = 'center';
      _ctx.fillStyle = "rgb(100, 100, 20)";
      _ctx.font = '48px Arial';
      _ctx.fillText(date.toLocaleString(), c.width/2.0, c.height * 0.5 + 70);
      */

      _ctx.lineCap = "round";

      /*
       * HOUR
       */
      h = h % 12;
      let angle = (90 - (h + min/60.0) * 360.0/12.0) * Math.PI/180;
      let dx = 0.8 * len * Math.cos(angle);
      let dy = -0.8 * len * Math.sin(angle);
      
      _ctx.beginPath();
      _ctx.moveTo(x, y);
      _ctx.lineTo(x + dx, y + dy);
      _ctx.lineWidth = lw * 1.6;
      _ctx.strokeStyle = "rgb(50, 50, 255)";
      _ctx.stroke();
      _ctx.closePath();
      
      /*
       * MINUTE
       */
      angle = (90 - (min + s/60.0) * 360.0/60.0) * Math.PI/180;
      dx = 1.5 * len * Math.cos(angle);
      dy = -1.5 * len * Math.sin(angle);

      _ctx.beginPath();
      _ctx.moveTo(x, y);
      _ctx.lineTo(x + dx, y + dy);
      _ctx.lineWidth = lw;
      _ctx.strokeStyle = "rgb(255, 255, 50)";
      _ctx.stroke();
      _ctx.closePath();

      /*
       * SECOND -1, 0.5, 3, 4 , 5
       */
      angle = Math.PI/180;
      if (this.frequence < 0) {
        angle = (90 - (s + ms/1000.0) * 6.0) * angle;//360.0/60.0
      } else {
        let hz = this.frequence * 2;
        var gap = Math.floor(ms/(1000/hz));
        angle = (90 - (s + gap/hz) * 6.0) * angle;
      }
    
      //
      _ctx.lineWidth = lw * 0.5;
      dx = 1.7 * len * Math.cos(angle);
      dy = -1.7 * len * Math.sin(angle);
      _ctx.beginPath();
      _ctx.moveTo(x + dx, y + dy);
      dx = 0.4 * len * Math.cos(angle + Math.PI);
      dy = -0.4 * len * Math.sin(angle + Math.PI);
      _ctx.lineTo(x + dx, y + dy);
      
      _ctx.strokeStyle = "rgb(255, 50, 50)";
      _ctx.stroke();
      _ctx.closePath();

      /*
      _ctx.moveTo(x, y);
      _ctx.lineTo(x + dx, y + dy);
      _ctx.lineWidth = 10;
      _ctx.strokeStyle = "rgb(255, 50, 50)";
      _ctx.stroke();
      */
      
      _ctx.beginPath();
      _ctx.fillStyle = "rgb(255, 50, 50)";
      _ctx.arc(x, y, lw, 0, 2 * Math.PI, true);
      _ctx.fill();
      _ctx.closePath();
  }

}

window.addEventListener('resize', function() {
  init();
});

window.addEventListener('keydown', function(e) {
  //keyboard(e);
  if (!c_obj) return;

  switch(e.keyCode) {
    case 70://f
      c_obj.changeFreq();
      break;
    case 66://b
      scale = -scale;
      if (scale > 0) 
        initAnim();
      break;
    //keyboard({keyCode : 66})
    case 49: 
    case 50: 
    case 51: 
    case 52: 
      if (scale < 0) { 
        scale = -scale;
        initAnim();
      }
      if (e.keyCode == 49) scale = 1.0;
      if (e.keyCode == 50) scale = 1.0/2.0;
      if (e.keyCode == 51) scale = 1.0/3.0;
      if (e.keyCode == 52) scale = 1.0/4.0;
      break;
  }
  
}, false);

init();
initAnim();

/*
    a	c	e
    b	d	f
    0	0	1
    ctx.transform(a,b,c,d,e,f);
                  xscale, xskew, yscale, yskew, xoffset, yoffset
    ctx.resetTransform
*/ 

</script>
