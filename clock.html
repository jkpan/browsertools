
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
      body {
        margin: 0px;
        height: 100%;
        background-color:green
        /*cursor:none;*/
      }
      main {
        position: fixed;
        width: 100%;
        height: 100%;
      }
      ::-webkit-scrollbar {
        display: none;
      }
      hr {
        border: 4px solid #00ff00;
      }
    </style>
    </head>   
<body>

  <canvas id="canvas" width="100" height="100"></canvas>

</body>

</html>

<script type="text/javascript" charset="UTF-8">

var canvas;
var ctx;
var scale = 1.0;

var pre = 0;
var particles = [];
var frequence = -1;

function init() {
    
    canvas = document.getElementById("canvas");
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;
    ctx = canvas.getContext("2d");
}

function anim_update(elapse) {

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'green'; 
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  //if (img) ctx.drawImage(img,0,0, canvas.width, canvas.height);

  let dt = elapse - pre;
  pre = elapse;

  if (scale < 0) return;

  
  //transform
  let _scale = scale;
  let _gap = (1-_scale) * canvas.width + (scale < 1.0?
                                         _scale * (canvas.width - canvas.height)/2:0);
                                          //:0; 

  ctx.transform(_scale, 
                  0, 
                          0,      
                          _scale, 
                                    _gap, 
                                    (1-_scale) * canvas.height);
  //xscale, xskew, yscale, yskew, xoffset, yoffset
  
  for (var i = 0;i<particles.length;i++) {
    particles[i].update(canvas, ctx, dt);
  }

  ctx.resetTransform();

  window.requestAnimationFrame(anim_update);

}

//function randomPickAnim() { let idx = Math.floor(Math.random() * 5); initAnim(idx);}

function initAnim() {
  
  /* 
  if (particles.length >= 1) {
    for (var i = 0;i<particles.length;i++) {
      particles[i].release();
    }
  }
  */

  particles.length = 0;
  particles = [];

  particles[0] = newClock();
  particles[0].initial(canvas);
 
  window.requestAnimationFrame(anim_update);

}

function newClock() {
  let p = {
    release: function() { },
    initial: function (c) { },
    update: function (c, _ctx, dt) {
      
      var x = c.width/2.0;
      var y = c.height/2.0;
      var len = c.height/5.0;

      var date = new Date();

      let h = date.getHours();
      let min = date.getMinutes();
      let s = date.getSeconds();
      let ms = date.getMilliseconds();

      _ctx.strokeStyle = "rgb(150, 150, 150)";
      _ctx.fillStyle =  "rgba(0, 0, 0, 0.5)";
      _ctx.lineWidth = 16;
      _ctx.beginPath();
      _ctx.arc(x, y, 2 * len + 10, 0, 2 * Math.PI, true);
      _ctx.fill();
      _ctx.stroke();

      _ctx.fillStyle = "rgb(150, 150, 150)";
      for (let i = 0;i<12;i++) {
        let angle = (90 - i * 360.0/12.0) * Math.PI/180;
        let dx = 2 * len * Math.cos(angle);
        let dy = -2 * len * Math.sin(angle);
        _ctx.beginPath();
        _ctx.arc(x + dx, y + dy, len/12, 0, 2 * Math.PI, true);
        _ctx.fill();
      }

      //var n = d.getTime();
      let fs = c.width/16;
      _ctx.font = fs + "px Monospace";
      //_ctx.fillStyle = "rgb(100,100,100)" //if (Math.random() > 0.5) 
      
      _ctx.fillText((h<10?'0'+h:h) + ':' + 
                    (min<10?'0'+min:min) +':' + 
                    (s<10?'0'+s:s), 
                    fs, fs );
      _ctx.font = (fs/2) + "px Monospace";
      _ctx.fillText( date.getFullYear() + '/' + 
                    (date.getMonth() + 1) +'/' + 
                    date.getDate() 
                    // + '(' + date.getDay() + ')'
                    , fs, fs + fs/2 );
       
      /*
      _ctx.textAlign = 'center';
      _ctx.fillStyle = "rgb(100, 100, 20)";
      _ctx.font = '48px Arial';
      _ctx.fillText(date.toLocaleString(), c.width/2.0, c.height * 0.5 + 70);
      */

      _ctx.lineCap = "round";

      /*
       * HOUR
       */
      h = h % 12;
      let angle = (90 - (h + min/60.0) * 360.0/12.0) * Math.PI/180;
      let dx = 0.8 * len * Math.cos(angle);
      let dy = -0.8 * len * Math.sin(angle);
      
      _ctx.beginPath();
      _ctx.moveTo(x, y);
      _ctx.lineTo(x + dx, y + dy);
      _ctx.lineWidth = 40;
      _ctx.strokeStyle = "rgb(50, 50, 255)";
      _ctx.stroke();
      
      /*
       * MINUTE
       */
      angle = (90 - (min + s/60.0) * 360.0/60.0) * Math.PI/180;
      dx = 1.5 * len * Math.cos(angle);
      dy = -1.5 * len * Math.sin(angle);

      _ctx.beginPath();
      _ctx.moveTo(x, y);
      _ctx.lineTo(x + dx, y + dy);
      _ctx.lineWidth = 20;
      _ctx.strokeStyle = "rgb(255, 255, 50)";
      _ctx.stroke();
      
      /*
       * SECOND -1, 0.5, 3, 4 , 5
       */
      angle = Math.PI/180;
      if (frequence < 0) {
        angle = (90 - (s + ms/1000.0) * 6.0) * angle;//360.0/60.0
      } else {
        let hz = frequence * 2;
        var gap = Math.floor(ms/(1000/hz));
        angle = (90 - (s + gap/hz) * 6.0) * angle;
      }
    
      //
      dx = 1.7 * len * Math.cos(angle);
      dy = -1.7 * len * Math.sin(angle);
      _ctx.beginPath();
      _ctx.moveTo(x + dx, y + dy);
      dx = 0.3 * len * Math.cos(angle + Math.PI);
      dy = -0.3 * len * Math.sin(angle + Math.PI);
      _ctx.lineTo(x + dx, y + dy);
      _ctx.lineWidth = 10;
      _ctx.strokeStyle = "rgb(255, 50, 50)";
      _ctx.stroke();

      /*
      _ctx.moveTo(x, y);
      _ctx.lineTo(x + dx, y + dy);
      _ctx.lineWidth = 10;
      _ctx.strokeStyle = "rgb(255, 50, 50)";
      _ctx.stroke();
      */
      
      _ctx.beginPath();
      _ctx.fillStyle = "rgb(255, 50, 50)";
      _ctx.arc(x, y, 24, 0, 2 * Math.PI, true);
      _ctx.fill();

    }
  }
  return p;
}

function keyboard(e) {

  //alert(e.keyCode);
  /*
  if (e.keyCode == 16) {
    //keylock
    return;
  }
  */
  /*
  switch (e.keyCode) {
    case 113:
      if (funcInterval) {
        stopActionInterval();
        break;
      }
      startRestoreInterval();
      break;
    case 66: //'b'
      doblank = doblank == 0?1:0;
      break;
  }
  */

}

window.addEventListener('resize', function() {
  init();
});

window.addEventListener('keydown', function(e) {
  keyboard(e);
  switch(e.keyCode) {
    case 70://f
      switch(frequence) {
        case -1: frequence = 5; break;
        case 5:  frequence = 4; break;
        case 4:  frequence = 3; break;
        case 3:  frequence = 0.5; break;
        case 0.5: frequence = -1; break;
      }
      break;
    case 66://b
      scale = -scale;
      if (scale > 0) 
        initAnim();
      break;
    case 49: scale = 1.0; break;
    case 50: scale = 1/2.0; break;
    case 51: scale = 1/3.0; break;
    case 52: scale = 1/4.0; break;
  }
  
}, false);

init();
initAnim();


</script>

/*
    a	c	e
    b	d	f
    0	0	1
    ctx.transform(a,b,c,d,e,f);
                  xscale, xskew, yscale, yskew, xoffset, yoffset
    ctx.resetTransform
*/ 
