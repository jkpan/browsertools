<!-- <script type="text/javascript" src="newfile.js"></script> -->
<!DOCTYPE html>
<html>

<head>
    <meta name="viewport"
        content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height"
        charset="UTF-8" />
    <style>
        body {
            color: rgb(0, 255, 0);
            margin: 0% 0%;
            height: 100%;
            width: 100%;
            background-color: rgb(0, 128, 0);
            /* transparent; border: 2px solid rgb(0, 255, 0);*/
        }

        .wrapper {

            display: grid;
            gap: 0px;

            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;

            width: 100%;
            height: 100vh;

        }

        .full {
            grid-column: 1 / 25;
            grid-row: 1 / 25;
            user-select: none;
            border: none;
        }

        .reload {

            grid-column: 24 / 25;
            grid-row: 22 / 23;
            border: none;
            opacity: 25%;

            font-size: 24px;
            background-color: rgb(0, 150, 0);
            color: #00ff00;

            vertical-align: middle;

        }

        .reloadP {

            grid-column: 24 / 25;
            grid-row: 23 / 24;
            border: none;
            opacity: 25%;

            font-size: 24px;
            background-color: rgb(0, 150, 0);
            color: #00ff00;

            vertical-align: middle;

        }

        .ui {
            grid-column: 2 / 24;
            grid-row: 2 / 24;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        textarea {
            border: 2px solid rgb(0, 128, 0);
            border-radius: 2px;
            border-color: rgb(0, 255, 0);
            margin: 1%;
            outline: none;
            padding: 0px;
            box-sizing: border-box;
            background: rgb(0, 150, 0);
            color: rgb(0, 255, 0);
            width: 96%;
        }

        textarea:focus {
            border: 2px solid;
            border-color: rgb(0, 255, 0);
            box-shadow: 0 0 8px 0 rgb(0, 255, 0);
            background: rgb(0, 150, 0);
            color: rgb(0, 255, 0);
        }

        .okbutton {
            font-size: 24px;
            background-color: rgb(0, 150, 0);
            color: #00ff00;
            margin: 2% 2%;
            width: 50%;
            border: 2px solid;
            vertical-align: middle;
        }

        input[type=file] {
            border: 2px solid;
            border-color: rgb(0, 255, 0);
            box-shadow: 0 0 8px 0 rgb(0, 255, 0);
            background: rgb(0, 150, 0);
            background-color: rgb(0, 150, 0);
            color: rgb(0, 255, 0);
        }

        img {
            display: block;
            margin: 0 auto;
        }

        a {
            color: #00ff00;
        }

        .drop-area {
            width: 360px;
            height: 200px;
            border: 2px dashed #0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .centered {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: block;
        }

        /*
        input[type=checkbox] {
            color:rgb(0, 255, 0);
            background-color: green;
        }
        */
    </style>
</head>

<body>

    <!--hr size="8" width="100%" color="#00ff00"/-->

    <div class="wrapper">

        <div class="ui" id="ui">
            <button class="okbutton" type="button" onclick="window.opener.clean()">Clean</button><br />
            嵌入Google簡報, Canva簡報, Youtube影片...
            <input type="checkbox" id="loopchk" checked>
            <label>Loop(影片)</label>
            <textarea id="ppt_url" name="mytext" rows="5">
https://docs.google.com/presentation/d/e/2PACX-1vTACMqqdWpFOdQYp1x518Gl7Oy_AQdSHFsSewEcVFOF9LkxKO6d7SCTJl5mkgqPg291kcSEI9vPNq4b/embed?start=false&loop=false
          </textarea>
            <script type="text/javascript" charset="UTF-8">

                function appendToIframeSrc(inputString, appendString) {
                    return inputString.replace(/<iframe[^>]*\s+src=["']([^"']*)["']/i, (match, srcValue) => {
                        // 修改 src 的內容
                        const newSrc = srcValue + appendString;
                        // 替換 src 屬性
                        return match.replace(srcValue, newSrc);
                    });
                }

                function modifyIframeAttributes(inputString, newWidth, newHeight) {
                    return inputString.replace(/<iframe[^>]*>/i, (iframeTag) => {
                        // 更新 width 屬性
                        iframeTag = iframeTag.replace(/width\s*=\s*["'].*?["']/i, `width="${newWidth}"`);
                        // 更新 height 屬性
                        iframeTag = iframeTag.replace(/height\s*=\s*["'].*?["']/i, `height="${newHeight}"`);
                        return iframeTag;
                    });
                }

                function urlGo() {
                    let value = document.getElementById("ppt_url").value;
                    value = value.trim();
                    if (value.length == 0) return;
                    let loop = document.getElementById("loopchk").checked;

                    if (value.startsWith('<iframe')) {
                        value = modifyIframeAttributes(value, '100%', '100%');
                    }

                    window.opener.urlGo(value, loop);
                }
            </script>
            <br />
            <button class="okbutton" type="button" onclick="urlGo()">OK</button>
            <br />
            <ul>
                <li><a href="javascript:googleSlidesRemoveBar()">Google簡報若不要出現下方功能bar, '嵌入'用的url後方要加上'&rm=minimal'</a>
                </li>
                <li>Google簡報要打開speaker notes按's'</li>
                <li>Canva簡報, 檢查'嵌入'用的url後方有無"view?embed", 沒有就自己加上</li>
                <!--
            <li><a href="javascript:animLED()">LED動畫</a></li>
            0:無動畫 1:圈圈 2:星空In 3:星空Out 4:星空Inout 5:星空圈圈 6:下雪 7:煙火 8:舞台 9:時鐘 10:老電腦
            -->
            </ul>

            <hr size="4" width="100%" color="#00ff00" />
            本機檔案<br />
            <input type="checkbox" id="keepratio" checked>
            <label>維持比例(圖片)</label>
            <P></P>
            <div class="drop-area" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)"
                onclick="openFile('allfile')">
                <p>
                <ul>
                    <li>PDF</li>
                    <li>圖片</li>
                    <li>影片</li>
                </ul>
                </p>
            </div>
            <input id="allfile" type="file" hidden="true" onchange="selectFile(event)" />
        </div>
    </div>
</body>

</html>

<script type="text/javascript" charset="UTF-8">

    function googleSlidesRemoveBar() {

        let value = document.getElementById("ppt_url").value;
        value = value.trim();
        if (value.length == 0) return;

        if (value.startsWith('<iframe')) {
            let modifiedString = appendToIframeSrc(value, '&rm=minimal');
            document.getElementById("ppt_url").value = modifiedString;
        } else {
            value += '&rm=minimal';
            document.getElementById("ppt_url").value = value;
        }

    }

    function animLED() {
        let value = document.getElementById("ppt_url").value;
        value = value.trim();
        value = './led.html?anim=7&round=0';
        document.getElementById("ppt_url").value = value;
    }

    function getRootUrl() {
        let all = window.location.href; //console.log(all);
        let root = all.substr(0, all.length - '/newurl.html'.length); //console.log('root:' + root);
        return root;
    }

    function relativeUrl(url) {
        let root = getRootUrl();
        //let domain = window.location.origin;
        if (url.startsWith(root)) {
            let str = url.substr(root.length, url.length - root.length);
            return '.' + str;
        }
        return url;
    }

</script>

<script>
    var image_base64 = null;
    var forPlay = 0;

    function isKeepRatio() {
        var checkbox = document.getElementById("keepratio");
        var isChecked = checkbox.checked;
        return isChecked;
    }

    function selectFile(event) {
        let file = event.target.files[0];

        /*
        var fileInfo = "檔案名稱: " + file.name + "<br>" +
                                     "檔案類型: " + file.type + "<br>" +
                                     "檔案大小: " + file.size + " bytes";
        alert(fileInfo);
        */

        if (file.type.startsWith('text/html')) {
            displayHTMLFile(file);
            return;
        }

        if (file.type.startsWith('image/')) {
            displayImageFile(file);
            return;
        }
        if (file.type.startsWith('video/')) {
            displayVideoFile(file);
            return;
        }
        if (file.type.startsWith('application/pdf')) {
            displayPDFFile(file);
            return;
        }

    }

    function openFile(elmid) {
        document.getElementById(elmid).click();
    }

    function displayHTMLFile(file) {
        window.opener.displayHTMLFile(file);
    }

    function displayImageFile(file) {
        window.opener.displayImageFile(file, isKeepRatio());
    }

    function displayPDFFile(file) {
        window.opener.displayPDFFile(file);
    }

    function displayVideoFile(file) {
        let loop = document.getElementById("loopchk").checked;
        window.opener.displayVideoFile(file, loop);
    }

    //window.addEventListener('message', (e) => {}, false);

    function dropHandler(event) {

        event.preventDefault();

        // 檢查是否有拖拉的檔案
        if (event.dataTransfer.items) {
            // 使用 DataTransferItemList 物件來檢查檔案是否是圖片
            for (var i = 0; i < event.dataTransfer.items.length; i++) {
                if (event.dataTransfer.items[i].kind === 'file') {
                    var file = event.dataTransfer.items[i].getAsFile();
                    if (file.type.startsWith('text/html')) {
                        displayHTMLFile(file);
                        return;
                    }
                    if (file.type.startsWith('image/')) {
                        // 顯示圖片
                        displayImageFile(file);
                        return;
                    }
                    if (file.type === 'application/pdf') {
                        // 顯示PDF
                        //displayPDF(file);
                        displayPDFFile(file);
                        return;
                    }
                    if (event.dataTransfer.items[i].type.indexOf("video") !== -1) {
                        //var file = event.dataTransfer.items[i].getAsFile();
                        displayVideoFile(file);
                        return;
                    }
                }
            }
        }
    }

    function dragOverHandler(event) {
        event.preventDefault();
    }

    function reloadPage() {
        location.reload();
    }

    //window.addEventListener('beforeunload', function (e) { window.opener.clean(); });

</script>