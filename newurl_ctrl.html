<!DOCTYPE html>
<html>

<head>
    <meta name="viewport"
        content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height"
        charset="UTF-8" />
    <link rel="stylesheet" href="ui_green.css" />
    <style>
        body {
            color: rgb(0, 255, 0);
            height: 100%;
            width: 100%;
            background-color: rgb(80, 80, 80);
            margin: 5%;
            /* transparent; border: 2px solid rgb(0, 255, 0);*/
        }

        ::-webkit-scrollbar {
            display: none;
        }

        hr {
            width: 120%;
        }

        input[type=file] {
            border: 2px solid;
            border-color: rgb(0, 255, 0);
            box-shadow: 0 0 8px 0 rgb(0, 255, 0);
            background: rgb(0, 150, 0);
            background-color: rgb(0, 150, 0);
            color: rgb(0, 255, 0);
        }

        img {
            display: block;
            margin: 0 auto;
        }

        a {
            color: #00ff00;
        }

        .ctrl {
            width: 90%;
            height: 400px;
            border: none;
            justify-content: center;
            align-items: center;
        }

        .drop-area {
            width: 90%;
            height: 200px;
            border: 2px dashed #0f0;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }


        .dots {
            position: absolute;
            top: 0%;
            /* è·é›¢è¦–çª—é ‚éƒ¨ 10% */
            left: 0;
            /* ä¾éœ€æ±‚å¯èª¿æ•´ */
            background-color: darkgrey;
            width: 100%;
            height: 50px;
            vertical-align: middle;
        }
    </style>
</head>

<body>

    <div id="dots" class="dots"></div>
    <br>
    <br>
    <button style="background-color: red;" type="button" onclick="clean()">Remove</button>
    &nbsp;
    <button style="background-color: blue;" id="aBtn" onclick="setSlideAnim()">a2</button>
    &nbsp;
    <button style="background-color: blue;" onclick="window.opener.blank(true)">blank</button>
    <button style="background-color: blue;" onclick="window.opener.blank(false)">show</button>
    <button style="background-color: blue;" onclick="window.opener.bgTransparent()">é€æ˜</button>
    &nbsp;
    <button style="background-color: blue;" onclick="window.opener.goSubMoveRight();updateDots();">â—€ï¸</button>
    <button style="background-color: blue;" onclick="window.opener.goAddMoveLeft();updateDots();">â–¶ï¸</button>
    <p></p>
    <button onclick="urlGo('./subtitle/subtitle.html?action=play&mode=2', 'lyric')">æ­Œè©</button>
    <button onclick="urlGo('./subtitle/subtitle_b.html?action=play&colorsel=1&verseCount=2', 'Bible')">è–ç¶“</button>
    <button onclick="urlGo('./subtitle/subtitle_niv.html?colorsel=1&verseCount=2', 'NIV')">NIV</button>
    <button onclick="urlGo('./dash.html?app=æŠ•å½±ä¸­è‹±æ–‡è–ç¶“', 'CEBible')">é›™èªè–ç¶“</button>
    <br>
    <button onclick="urlGo('./led/marquee.html', 'LED')">LED</button>
    <button onclick="urlGo('./led/clock.html', 'clock')">æ™‚é˜</button>
    <button onclick="urlGo('./tools/camera_receive.html', 'camrece')">Camera</button>
    <button onclick="urlGo('dashboard.html', 'dash1')">Dash 1</button>
    <button onclick="urlGo('dashboard.html', 'dash2')">Dash 2</button>
    <button onclick="urlGo('dashboard.html', 'dash3')">Dash 3</button>
    <!-- <button onclick="urlGo('tabs.html', 'tabs')">é ç±¤</button> -->
    <button onclick="openLib()" style="background-color: #000000;">åœ–åº«</button>
    <p></p>

    <hr align="left" style="width:90%" />

    <div class="drop-area" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)"
        onclick="openFile('allfile')">
        <p>
        <ul>
            <li>PDF</li>
            <li>åœ–ç‰‡</li>
            <li>å½±ç‰‡</li>
        </ul>
        </p>
    </div>

    <input id="allfile" type="file" hidden="true" onchange="selectFile(event)" />
    <input type="checkbox" id="loopchk" checked>
    <label>Loop(å½±ç‰‡)</label>
    <input type="checkbox" id="showctrl" checked>
    <label>é¡¯ç¤ºæ§åˆ¶é …</label>
    <input type="checkbox" id="keepratio" checked>
    <label>ç¶­æŒæ¯”ä¾‹(åœ–ç‰‡)</label>
    <P></P>
    <!-- <a href="#tag_url"></a>; -->
    åµŒå…¥Googleç°¡å ±, Canvaç°¡å ±, Youtubeå½±ç‰‡...
    <textarea id="ppt_url" name="mytext" rows="5"></textarea>
    <P></P>
    <button type="button" onclick="urlGo()">OK</button>
    <P></P>
    <ul>
        <li><a href="javascript:googleSlidesRemoveBar()">Googleç°¡å ±è‹¥ä¸è¦å‡ºç¾ä¸‹æ–¹åŠŸèƒ½bar, 'åµŒå…¥'ç”¨çš„urlå¾Œæ–¹è¦åŠ ä¸Š'&rm=minimal'</a>
        </li>
        <li>Googleç°¡å ±è¦æ‰“é–‹speaker notesæŒ‰'s'</li>
        <li>Canvaç°¡å ±, æª¢æŸ¥'åµŒå…¥'ç”¨çš„urlå¾Œæ–¹æœ‰ç„¡"view?embed", æ²’æœ‰å°±è‡ªå·±åŠ ä¸Š</li>
        <!--
        <li><a href="javascript:animLED()">LEDå‹•ç•«</a></li>
        0:ç„¡å‹•ç•« 1:åœˆåœˆ 2:æ˜Ÿç©ºIn 3:æ˜Ÿç©ºOut 4:æ˜Ÿç©ºInout 5:æ˜Ÿç©ºåœˆåœˆ 6:ä¸‹é›ª 7:ç…™ç« 8:èˆå° 9:æ™‚é˜ 10:è€é›»è…¦
        -->
    </ul>

    <script type="text/javascript" charset="UTF-8">

        const dotsContainer = document.getElementById('dots');

        function updateDots() {
            let s_array = window.opener.getState();
            let items = s_array[0];
            let current = s_array[1];
            dotsContainer.innerHTML = '';

            for (let i = 0; i < items.length; i++) {

                let des = items[i].getAttribute('title');
                if (!des)
                    des = items[i].getAttribute('des');
                let dot = addDots(des, i);
                if (i == current) {
                    //dot.style.color = '#f00';
                    dot.style.fontSize = '24px';
                    dot.style.border = '2px solid #f00';
                }
            }

        }

        function addDots(des, idx) {

            let caption = '';
            if (des.startsWith('file-')) {
                caption = 'ğŸ“‚';
            } else if (des.startsWith('url-')) {
                caption = 'ğŸŒ';
            } else if (des.startsWith('lyric')) {
                caption = 'ğŸ¤';
            } else if (des.startsWith('Bible')) {
                caption = 'ğŸ“–';
            } else if (des.startsWith('NIV')) {
                caption = 'è‹±ğŸ“–';
            } else if (des.startsWith('CEBible')) {
                caption = 'ğŸ“–ğŸ“–';
            } else if (des.startsWith('LED')) {
                caption = 'ğŸ“±';
            } else if (des.startsWith('clock')) {
                caption = 'ğŸ•—';
            } else if (des.startsWith('dash1')) {
                caption = 'ğŸ›ï¸1';
            } else if (des.startsWith('dash2')) {
                caption = 'ğŸ›ï¸2';
            } else if (des.startsWith('dash3')) {
                caption = 'ğŸ›ï¸3';
            } else if (des.startsWith('tabs')) {
                caption = 'ğŸ—‚ï¸';
            } else if (des.startsWith('camrece')) {
                caption = 'ğŸ“·';
            }

            const dot = document.createElement('label');

            dot.innerHTML = caption;
            dot.style.marginLeft = '10px';
            dot.style.fontSize = '20px';
            dot.style.border = '1px solid #000';
            dot.style.borderRadius = '4px';
            //dot.className = 'dot';// + (i === 0 ? ' active' : '');
            //dot.dataset.idx = i;
            //dot.title = `${i + 1}/${images.length}`;
            //dot.style.border = '2px';
            dot.addEventListener('click', (evt) => {
                //console.log('label click ' + evt.target);
                window.opener.jump2(idx);
                updateDots();
            });
            dotsContainer.appendChild(dot);
            return dot;
        }


        document.getElementById("ppt_url").value = "https://docs.google.com/presentation/d/e/2PACX-1vTACMqqdWpFOdQYp1x518Gl7Oy_AQdSHFsSewEcVFOF9LkxKO6d7SCTJl5mkgqPg291kcSEI9vPNq4b/embed?start=false&loop=false";

        function appendToIframeSrc(inputString, appendString) {
            return inputString.replace(/<iframe[^>]*\s+src=["']([^"']*)["']/i, (match, srcValue) => {
                // ä¿®æ”¹ src çš„å…§å®¹
                const newSrc = srcValue + appendString;
                // æ›¿æ› src å±¬æ€§
                return match.replace(srcValue, newSrc);
            });
        }

        function modifyIframeAttributes(inputString, newWidth, newHeight) {
            let newstring = inputString.replace(/<iframe[^>]*>/i, (iframeTag) => {
                // æ›´æ–° width å±¬æ€§
                iframeTag = iframeTag.replace(/width\s*=\s*["'].*?["']/i, `width="${newWidth}"`);
                // æ›´æ–° height å±¬æ€§
                iframeTag = iframeTag.replace(/height\s*=\s*["'].*?["']/i, `height="${newHeight}"`);
                return iframeTag;
            });
            if (newstring.indexOf(`width=${newWidth}`) < 0 ||
                newstring.indexOf(`height=${newHeight}`) < 0) {
                newstring = inputString.replace(
                    '<iframe',
                    `<iframe width="${newWidth}" height="${newHeight}" `
                );
            }
            return newstring;
        }

        function urlGo(url, key) {

            if (key) {
                if (window.opener.jump(key)) {
                    updateDots();
                    return;
                }
            }

            let value = '';
            if (url != null)
                value = url;
            else
                value = document.getElementById("ppt_url").value;

            value = value.trim();
            if (value.length == 0) return;
            let loop = document.getElementById("loopchk").checked;
            let ctrl = document.getElementById("showctrl").checked;


            if (value.startsWith('<iframe')) {
                value = modifyIframeAttributes(value, '100%', '100%');
            }
            console.log('url : ' + value + '  ' + isKeepRatio());
            window.opener.urlGo(value, loop, key, isKeepRatio(), ctrl);



            setTimeout(() => {
                updateDots();
            }, 1000);



        }

    </script>

    <hr align="left" style="width:90%" />

    <p></p>
    <button onclick="divGo('./subtitle/subtitle.html?action=ctrl&mode=2', 'frame_song', 'div_song')">æ­Œè©æ§åˆ¶</button>
    <button
        onclick="divGo('./subtitle/subtitle_b.html?action=ctrl&colorsel=1&verseCount=2', 'frame_Bible', 'div_Bible')">ç¶“æ–‡æ§åˆ¶</button>
    <p></p>
    <div id="div_song" hidden>
        <iframe id="frame_song" class="ctrl"></iframe>
    </div>
    <p></p>
    <div id="div_Bible" hidden>
        <iframe id="frame_Bible" class="ctrl"></iframe>
    </div>
</body>

</html>

<script type="text/javascript" charset="UTF-8">

    function divGo(url, frame, div) {
        if (document.getElementById(div).hidden) {
            if (!document.getElementById(frame).src || document.getElementById(frame).src.length == 0)
                document.getElementById(frame).src = url;
            document.getElementById(div).hidden = false;
        } else {
            document.getElementById(div).hidden = true;
        }
    }

    var animType = 2;

    function isSafariBrowser() {
        var ua = navigator.userAgent.toLowerCase();
        if (ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1) //safariçš„uaåªæœ‰'safari'
            return 1;
        if (ua.indexOf('chrome') !== -1) //chrome çš„ ua 'safari' 'chrome' éƒ½æœ‰
            return 0;
        return -1;
    }

    function setSlideAnim() {
        animType = (animType + 1) % 5;
        _setSlideAnim();
    }

    function _setSlideAnim() {

        var b = document.getElementById('aBtn');
        let caption = b.textContent;
        if (animType == 0) {
            b.textContent = '--';
        } else {
            b.textContent = 'a' + animType;//  <> ^v
        }

        window.opener.setSlideAnim(animType);
    }


    function googleSlidesRemoveBar() {

        let value = document.getElementById("ppt_url").value;
        value = value.trim();
        if (value.length == 0) return;

        if (value.startsWith('<iframe')) {
            let modifiedString = appendToIframeSrc(value, '&rm=minimal');
            document.getElementById("ppt_url").value = modifiedString;
        } else {
            value += '&rm=minimal';
            document.getElementById("ppt_url").value = value;
        }

    }

    function animLED() {
        let value = document.getElementById("ppt_url").value;
        value = value.trim();
        value = './led/led.html?anim=7&round=0';
        document.getElementById("ppt_url").value = value;
    }

    function getRootUrl() {
        let all = window.location.href; //console.log(all);
        let root = all.substring(0, all.indexOf('/newurl_ctrl.html')); //console.log('root:' + root);
        return root;
    }

    function relativeUrl(url) {
        let root = getRootUrl();
        //let domain = window.location.origin;
        if (url.startsWith(root)) {
            let str = url.substring(root.length, url.length);
            return '.' + str;
        }
        return url;
    }

</script>

<script>
    var image_base64 = null;
    var forPlay = 0;

    function isKeepRatio() {
        var checkbox = document.getElementById("keepratio");
        var isChecked = checkbox.checked;
        return isChecked;
    }

    function handleFile(file) {
        if (file.type.startsWith('text/html')) {
            displayHTMLFile(file);
        } else if (file.type.startsWith('image/')) {
            displayImageFile(file);
        } else if (file.type.startsWith('video/')) {
            displayVideoFile(file);
        } else if (file.type.startsWith('application/pdf')) {
            displayPDFFile(file);
        }

        setTimeout(() => {
            updateDots();
        }, 500);

    }
    function selectFile(event) {
        let file = event.target.files[0];
        handleFile(file);
    }

    function openFile(elmid) {
        document.getElementById(elmid).click();
    }

    function displayHTMLFile(file) {
        window.opener.displayHTMLFile(file);
    }

    function displayImageFile(file) {
        window.opener.displayImageFile(file, isKeepRatio());
    }

    function displayPDFFile(file) {
        window.opener.displayPDFFile(file);
    }

    function displayVideoFile(file) {
        let loop = document.getElementById("loopchk").checked;
        let ctrl = document.getElementById("showctrl").checked;
        window.opener.displayVideoFile(file, loop, ctrl);
    }

    //window.addEventListener('message', (e) => {}, false);

    function dropHandler(event) {

        event.preventDefault();

        // æª¢æŸ¥æ˜¯å¦æœ‰æ‹–æ‹‰çš„æª”æ¡ˆ
        if (event.dataTransfer.items) {
            // ä½¿ç”¨ DataTransferItemList ç‰©ä»¶ä¾†æª¢æŸ¥æª”æ¡ˆæ˜¯å¦æ˜¯åœ–ç‰‡
            for (var i = 0; i < event.dataTransfer.items.length; i++) {
                if (event.dataTransfer.items[i].kind === 'file') {
                    var file = event.dataTransfer.items[i].getAsFile();
                    handleFile(file);
                }
            }
        }
    }

    function dragOverHandler(event) {
        event.preventDefault();
    }

    function pushFromUpload(content) {//alert(content);
        document.getElementById("ppt_url").value = content;
        window.focus();
        const targetElement = document.getElementById('ppt_url');
        if (targetElement) { // Check if the element exists before attempting to scroll
            targetElement.scrollIntoView();
        }
        //urlGo();
    }

    var liber = null;
    function openLib() {
        closeLiber();
        liber = window.open("./upload.html", "_blank", 'width=800, height=600, left=100, top=100');
    }

    function closeLiber() {
        if (liber)
            liber.close();
        liber = null;
    }

    function clean() {
        window.opener.clean();
        updateDots();
    }

    //window.addEventListener('beforeunload', function (e) { window.opener.clean(); });
    window.addEventListener('keyup', (e) => {
        //e.preventDefault();
        //e.stopPropagation();
        //console.log("key up : " +  e.code);
        switch (e.code) {
            case 'Minus':
                window.opener.goSubMoveRight();
                break;
            case 'Equal':
                window.opener.goAddMoveLeft();
                break;
            case 'Digit0':
                window.opener.jump2(10);
                break;
            case 'Digit1': case 'Digit2': case 'Digit3': case 'Digit4':
            case 'Digit5': case 'Digit6': case 'Digit7': case 'Digit8':
            case 'Digit9':
                let value = e.keyCode - 48 - 1;
                window.opener.jump2(value);
                break;
        }
        updateDots();
    }, false);

    window.addEventListener("beforeunload", function (event) {
        closeLiber();
        if (!isSafariBrowser())
            window.opener.openCtrl_reborn();
    });

    animType = window.opener.getSlideAnim();
    _setSlideAnim();
    updateDots();

</script>