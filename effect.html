<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <style>
      body {
        margin: 0px;
        height: 100%;
        background-color:rgb(112, 112, 112);
      }
      main {
        position: fixed;
        width: 100%;
        height: 100%;
      }
      ::-webkit-scrollbar {
        display: none;
      }
    </style>
    </head>   
<body>

  <canvas id="canvas" width="100" height="100"></canvas>

</body>
</html>

<script type="text/javascript" charset="UTF-8">

var canvas;
var ctx;

function init() {
    canvas = document.getElementById("canvas");
    ctx = canvas.getContext("2d");
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;
    
}

function repaint() {

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = 'green';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

}

function canvasResize() {
  init();
  repaint();
}

function _update() {

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = 'green';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

}

var pre = 0;
var particles = [];
var animSwh = 0;

function keyboard(e) {

    //alert(e.keyCode);
    let len = particles.length;
    switch (e.keyCode) {
  
        case 48:
            initAnim(0);
            break;
        case 49: case 50: case 51:  //case 52:  case 53:  case 54:  case 55:  case 56:  case 57:
            var value = e.keyCode - 48;
            for (let i = 0;i<5;i++) {
                particles[len + i] = applaud();
                particles[len + i].initial(canvas, value);
            }
            initAnim(1);
          break;
        case 81: //'Q'
            particles[len] = hammer();
            particles[len].initial(canvas);
            initAnim(1);
            break;
        case 87:
            particles[len] = character();
            particles[len].initial(canvas, '❓');
            initAnim(1);
            break;
        case 69:
            particles[len] = character();
            particles[len].initial(canvas, '❗');
            initAnim(1);
            break;
        case 82:
            particles[len] = character();
            particles[len].initial(canvas, '👍');
            initAnim(1);
            break;
        case 84:
            particles[len] = character();
            particles[len].initial(canvas, '🧡');
            initAnim(1);
            break;
        case 89:
            particles[len] = character();
            particles[len].initial(canvas, '💔');
            initAnim(1);
            break;
        case 65: case 83: case 68: case 70: case 71: case 72: //'A'
            particles[len] = passby();
            if (e.keyCode == 65) particles[len].initial(canvas, 1); else 
            if (e.keyCode == 83) particles[len].initial(canvas, 2); else 
            if (e.keyCode == 68) particles[len].initial(canvas, 3); else 
            if (e.keyCode == 70) particles[len].initial(canvas, 4); else 
            if (e.keyCode == 71) particles[len].initial(canvas, 5); else 
            if (e.keyCode == 72) particles[len].initial(canvas, 6);
            initAnim(1);
            break;
        case 90: //'Z' 
        case 88: //'X'
            particles[len] = animframe();
            if (e.keyCode == 90) particles[len].initial(canvas, 1); else 
            if (e.keyCode == 88) particles[len].initial(canvas, 2);
            initAnim(1);
            break;
    }
}
//randomPick();
var mouseX;
var mouseY;

window.addEventListener('resize', canvasResize);
canvasResize();

window.addEventListener('keyup', keyboard, false);
canvas.addEventListener('mousemove', e => {
    mouseX = e.x;
    mouseY = e.y;
    
});

function initAnim(idx) {

    if (idx == 0) {
        for (var i = 0;i<particles.length;i++) {
            particles[i].release();
        }
        animSwh = 0;
        return;
    }

    if (animSwh == 0) {
        animSwh = 1;
        pre = -1;
        window.requestAnimationFrame(anim_update);
        console.log('requestAnimationFrame anim_update');
    }  

}

function anim_update(elapse) {

    _update();

    if (pre < 0) pre = elapse;

    let dt = elapse - pre;
    pre = elapse;

    for (var i = 0;i<particles.length;i++) {
        particles[i].update(canvas, ctx, dt);
        if (particles[i].state == 0) {
            particles.splice(i, 1);
            i--;
        }
    }

    console.log('len : ' + particles.length);

    if (particles.length == 0) animSwh = 0;


    if (animSwh == 1) {
        window.requestAnimationFrame(anim_update);
    } else {
        _update();
        console.log('anim_update end');
    }

}

function applaud() {
  let p = {
    x: 0,
    y: 0,
    dest_y:0,
    txt: '',
    elapse:0,
    fontsize:100,
    txt_0: '🤲', //'🙌',
    txt_1: '👏',
    //👐🙏
    state: 1,
    rotate: 0,
    release: function() { 
        this.txt = '';
        this.state = 0;
    },
    initial: function (c, type) {
      this.state = type;
      if (type == 1) {
        this.txt_0 = '🤲';
        this.txt_1 = '👏';
      } else if (type == 2) {
        let r = Math.floor(Math.random() * 2);
        if (r == 0) {
            this.txt_0 = '😀';
            this.txt_1 = '🙂';
        } else {
            this.txt_0 = '😄';
            this.txt_1 = '😊';
        } 
      } else if (type == 3) {
        let r = Math.floor(Math.random() * 4);
        if (r == 0) {
            this.txt_0 = '😎';
            this.txt_1 = '😎';
        } else if (r == 1) {
            this.txt_0 = '🥸';
            this.txt_1 = '🥸';
        } else if (r == 2) {
            this.txt_0 = '🤪';
            this.txt_1 = '🤪';
        } else if (r == 3) {
            this.txt_0 = '😜';
            this.txt_1 = '😜';
        }
      }

      if ( Math.floor(2 * Math.random()) == 0)
        this.txt = this.txt_0;
      else 
        this.txt = this.txt_1;
      
      this.fontsize = c.height/8 - Math.floor(c.height/20 * Math.random());

      this.x = c.width * Math.random(); 
      this.dest_y = c.height - this.fontsize - Math.floor(c.height/4 * Math.random());
      this.y = c.height + this.fontsize;
      this.elapse = 0;
    },
    
    update: function (c, _ctx, dt) {

        if (this.state == 0) return;

        _ctx.textAlign = "center";
        _ctx.textBaseline = 'middle';//'bottom
        _ctx.font = this.fontsize + 'px Monospace';//this.fontsize + "px";
        
        if (this.state == 3) {
            
            _ctx.save();
            _ctx.translate(this.x, this.y);
            this.rotate += 1.0 * dt * 0.001;
            _ctx.rotate(this.rotate);
            _ctx.fillText(this.txt, 0, 0);//this.x, this.y); 
            _ctx.restore();
            
        } else {
            _ctx.fillText(this.txt, this.x, this.y);
        }

        if (this.dest_y < c.height) {
            this.y = this.y + (this.dest_y - this.y) * dt * 0.001 * 2;
            if (Math.abs(this.y - this.dest_y) < 4) 
                this.dest_y = c.height + this.fontsize * 2;
        } else {
            this.y = this.y + (this.dest_y - this.y) * dt * 0.001 * 2;
        }
        
        //if (this.dest_y < c.height && Math.abs(this.y - this.dest_y) < 4) this.dest_y = c.height + this.fontsize * 2;
        
        if (this.dest_y > c.height && Math.abs(this.y - this.dest_y) < 4) {
            this.release();
            return;
        }

        this.elapse += dt * 0.001;
        if (this.elapse > (0.1 + Math.random() * 0.15)) {
            this.elapse = 0;
            if (this.txt == this.txt_0) 
                this.txt = this.txt_1;
            else 
                this.txt = this.txt_0;
        }
        
    }
  }
  return p;
}

function hammer() {
  let p = {
    x: 0,
    y: 0,
    txt: '🔨',
    elapse:0,
    fontsize:100,
    state: 1,
    rotate: 0,
    _rotate: Math.PI/6,
    easein:function(_t) {
      return _t * _t * _t;
    },
    easeout:function(_t) {
      return -_t * _t + 2 * _t;
    },
    release: function() { 
        this.txt = '';
        this.state = 0;
    },
    initial: function (c) {
      this.txt = '🔨';
      this.fontsize = c.height/8;

      this.x = mouseX + this.fontsize;//c.width/2;// * Math.random(); 
      this.y = mouseY;//c.height/2;
      this.elapse = 0;
      this.rotate = this._rotate;
      this.state = 1;
    },
    update: function (c, _ctx, dt) {

        if (this.state == 0) return;

        _ctx.textAlign = "right";
        _ctx.textBaseline = 'bottom';//'bottom
        _ctx.font = this.fontsize + 'px Monospace';//this.fontsize + "px";
        
        
        this.elapse += dt/1000.0;
        let ein = this.easein(this.elapse/0.2);
        this.rotate = this._rotate + (-Math.PI/3 - this._rotate) * ein;
        if (this.rotate < -Math.PI/3) 
            this.rotate = -Math.PI/3;
        
        //this.rotate -= 0.1;
        
        _ctx.save();
        _ctx.translate(this.x, this.y);
        _ctx.rotate(this.rotate);
        _ctx.fillText(this.txt, 0, 0);//this.x, this.y); 
        _ctx.restore();

        if (Math.abs(-Math.PI/3 - this.rotate) < 0.01) {
            this.state = 0;
        }

        //if (this.elapse > 1.0) this.state = 0;
    }
  }
  return p;
}

function passby() {
  let p = {
    x: 0,
    y: 0,
    txt: '🚗',//🚗 🚙 🚕 🚌 🏎 🚓 🚚 🛻
    fontsize:100,
    velocity:250,
    state: 1,
    disturb:0,
    release: function() { 
        this.txt = '';
        this.state = 0;
    },
    initial: function (c, idx) {
      this.fontsize = c.height/8;
      this.x = canvas.width + this.fontsize;
      this.y = mouseY;
      this.state = idx;
      this.velocity = 200 + 100 * Math.random();
      switch(this.state) {
        case 1: this.txt = '🚗'; break;
        case 2: this.txt = '🚓'; this.velocity *= 2; break;
        case 3: this.txt = '🚕'; break;
        case 4: this.txt = '🚚'; break;
        case 5: this.txt = '🏎'; this.velocity *= 3; break;
        case 6: this.txt = '🚌'; this.velocity *= 0.8; break;
        default: this.txt = '🚗'; break;
      }
    },
    
    update: function (c, _ctx, dt) {

        if (this.state == 0) return;

        _ctx.textAlign = "center";
        _ctx.textBaseline = 'middle';//'bottom
        _ctx.font = this.fontsize + 'px Monospace';//this.fontsize + "px";
        
        if (this.state == 5) 
            this.disturb = 0;
        
        this.velocity += dt * 0.1;
        this.x -= this.velocity * dt * 0.001;
        _ctx.fillText(this.txt, this.x, this.y + this.disturb); 
        
        this.disturb = Math.floor(Math.random() * 5) - 2; //012012
        
        if (this.x < -this.fontsize) this.release();
        
    }
  }
  return p;

}

function animframe() {
  let p = {
    x: 0,
    y: 0,
    txt: '🌏',
    elapse:0,
    _elapse:0,
    fontsize:100,
    state: 1,
    order: 0,
    release: function() { 
        this.txt = '';
        this.state = 0;
    },
    initial: function (c, idx) {
      this.txt = '🚗';
      this.fontsize = c.height/8;

      this.x = mouseX; 
      this.y = mouseY;//c.height/2;
      this.state = idx;
      this.order = 0;
      if (this.state == 1) this.txt = '🌏';
      if (this.state == 2) this.txt = '🌕';
    },
    
    update: function (c, _ctx, dt) {

        if (this.state == 0) return;

        _ctx.textAlign = "center";
        _ctx.textBaseline = 'middle';//'bottom
        _ctx.font = this.fontsize + 'px Monospace';//this.fontsize + "px";
        
        if (this._elapse > 0.1) {

            this._elapse = 0;

            if (this.state == 1) {
                this.order = (this.order + 1) %3;
                switch(this.order) {
                    case 0: this.txt = '🌏'; break;
                    case 1: this.txt = '🌍'; break;
                    case 2: this.txt = '🌎'; break;
                }
            } else if (this.state == 2) {
                //🌕🌖🌗🌘🌑🌒🌓🌔
                this.order = (this.order + 1) %8;
                switch(this.order) {
                    case 0: this.txt = '🌕'; break;
                    case 1: this.txt = '🌖'; break;
                    case 2: this.txt = '🌗'; break;
                    case 3: this.txt = '🌘'; break;
                    case 4: this.txt = '🌑'; break;
                    case 5: this.txt = '🌒'; break;
                    case 6: this.txt = '🌓'; break;
                    case 7: this.txt = '🌔'; break;
                }
                
            }

        }
    
        _ctx.fillText(this.txt, this.x, this.y);
        
        this._elapse += dt/1000.0;
        this.elapse += dt/1000.0;
        
        if (this.elapse > 4.0) this.release();
        
    }
  }
  return p;
  
}

function character() {
  let p = {
    x: 0,
    y: 0,
    txt: '',
    elapse:0,
    fontsize:100,
    state: 1,
    release: function() { 
        this.txt = '';
        this.state = 0;
    },
    initial: function (c, _txt) {
      this.txt = _txt;
      this.fontsize = c.height/8;

      this.x = mouseX; 
      this.y = mouseY;//c.height/2;
      this.state = 1;
    },
    
    update: function (c, _ctx, dt) {

        if (this.state == 0) return;

        _ctx.textAlign = "center";
        _ctx.textBaseline = 'middle';//'bottom
        _ctx.font = this.fontsize + 'px Monospace';//this.fontsize + "px";
            
        _ctx.fillText(this.txt, this.x, this.y);
        
        this.elapse += dt/1000.0;
        
        if (this.elapse > 2.0) 
            this.release();
        
    }
  }
  return p;
  
}

</script>

