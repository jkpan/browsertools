<script type="text/javascript" charset="UTF-8">

const GRID_W = 32;
const GRID_H = 32;

function initContent() {
  applets = [
        new Applet({x:24, y:2, w:11, h:10, elm:document.getElementById("frame_clock")}),
        new Applet({x:1, y:14, w:13, h:18,  elm:document.getElementById("frame_song")}),
        new Applet({x:15, y:14, w:17, h:18, elm:document.getElementById("frame_Bible")}),
        new Applet({x:1, y:1, w:4, h:32, elm:document.getElementById("frame_news")}),
        new Applet({x:5, y:1, w:12, h:12, elm:document.getElementById("div_slide")}),
  ]
}

class Applet {

  x = 0;
  y = 0;
  w = 0;
  h = 0;
  elm = null;

  constructor(data) {
    this.x = data.x;
    this.y = data.y;
    this.w = data.w;
    this.h = data.h;
    this.elm = data.elm;
    //this.settle();
    this.adjust();
  }

  moveX_(_x) {

    let fix_rx = this.x + this.w;
   
    if (_x < 1) return false;
    if (_x >= fix_rx) return false;
    if (fix_rx - _x < 2) return false;

    this.x = _x;
    this.w = fix_rx - this.x;

    this.settle();
    return true;

  }

  move_X(_x) {

    if (_x > GRID_W + 1) return false;
    if (_x <= this.x) return false;
    if (_x - this.x < 2) return false;
    this.w = _x - this.x;
    this.settle();
    return true;

  }

  moveY_(_y) {

    let fix_by = this.y + this.h;
   
    if (_y < 1) return false;
    if (_y >= fix_by) return false;
    if (fix_by - _y < 2) return false;

    this.y = _y;
    this.h = fix_by - this.y;

    this.settle();
    return true;
  }

  move_Y(_y) {

    if (_y > GRID_H + 1) return false;
    if (_y <= this.y) return false;
    if (_y - this.y < 2) return false;
    this.h = _y - this.y;
    this.settle();
    return true;
  }

  moveBody(_x, _y) {

    if (_x < 1) {
      return false;
    }
    if (_x + this.w > GRID_W + 1) {
      return false;
    }
    if (_y < 1) {
      return false;
    }
    if (_y + this.h > GRID_H + 1) {
      return false;
    }
    this.x = _x;
    this.y = _y;
    this.settle();
    return true;
  }

  adjust() {

    if (this.w < 1) this.w = 1;
    if (this.h < 1) this.h = 1;
  
    if (this.x < 1) {
      this.x = 1;
    }
    if (this.x + this.w > GRID_W + 1) {
      this.w = GRID_W + 1 - this.x;
    }

    if (this.y < 1) {
      this.y = 1;
    }
    if (this.y + this.h > GRID_H + 1) {
      this.h = GRID_H + 1 - this.y;
    }

    this.settle();
  }

  settle() {
    //if (!checkRange()) return;
    this.elm.style.gridColumn = this.x + ' / ' + (this.x + this.w);//' '2 / 4';
    this.elm.style.gridRow = this.y + ' / ' + (this.y + this.h);//'1 / 8';
    //console.log(this.x + '/' + (this.x + this.w));
    //console.log(this.y + '/' + (this.y + this.h));
  }

  checkInside(px, py) { //pixel x y
    let _gap_w = canvas.width/GRID_W;
    let _gap_h = canvas.height/GRID_H;
    if (px < (this.x - 1) * _gap_w) return false;
    if (py < (this.y - 1) * _gap_h) return false;
    if (px > (this.x + this.w - 1) * _gap_w) return false;
    if (py > (this.y + this.h - 1) * _gap_h) return false;
    return true;
  }

  check_L_Edge(px) {
    let _gap_w = canvas.width/GRID_W;
    let _gap = 0.25 * _gap_w;
    if (Math.abs(px - (this.x - 1) * _gap_w) < _gap) {
      return true;
    }
    return false;
  }

  check_R_Edge(px) {
    let _gap_w = canvas.width/GRID_W;
    let _gap = 0.25 * _gap_w;
    if (Math.abs(px - (this.x + this.w - 1) * _gap_w) < _gap) {
      return true;
    }
    return false;
  }

  check_T_Edge(py) {
    let _gap_h = canvas.height/GRID_H;
    let _gap = 0.25 * _gap_h;
    if (Math.abs(py - (this.y - 1) * _gap_h) < _gap) {
      return true;
    }
    return false;
  }

  check_B_Edge(py) {
    let _gap_h = canvas.height/GRID_H;
    let _gap = 0.25 * _gap_h;
    if (Math.abs(py - (this.y + this.h - 1) * _gap_h) < _gap) {
      return true;
    }
    return false;
  }

  isHide() {
    return this.elm.hidden;
  }
  
  hideSelf() {
    this.elm.hidden = true;
  }

  showSelf() {
    this.elm.hidden = false;
  }

  removeSelf() {
    this.elm.remove();
  }

  enlargeSelf() {
    this.x = 1;
    this.y = 1;
    this.w = GRID_W;
    this.h = GRID_W;
    this.settle();
  }

  isClickHide(px, py) {
    let _gap_w = canvas.width/GRID_W;
    let _gap_h = canvas.height/GRID_H;
    if (px < (this.x - 2 + this.w) * _gap_w) return false;
    if (py > (this.y + 1) * _gap_h || py < (this.y) * _gap_h) return false;
    return true;
  }

  isClickRemove(px, py) {
    let _gap_w = canvas.width/GRID_W;
    let _gap_h = canvas.height/GRID_H;
    if (px < (this.x - 2 + this.w) * _gap_w) return false;
    if (py > (this.y) * _gap_h) return false;
    return true;
  }

  isClickOntop(px, py) {
    let _gap_w = canvas.width/GRID_W;
    let _gap_h = canvas.height/GRID_H;
    if (px < (this.x - 3 + this.w) * _gap_w) return false;
    if (py > (this.y) * _gap_h) return false;
    return true;
  }

  drawSelRect() {

    let _gap_w = canvas.width/GRID_W;
    let _gap_h = canvas.height/GRID_H;
  
    ctx.lineWidth = _gap_h * 0.25;
    ctx.strokeStyle = 'rgb(0,255,0)';

    ctx.strokeRect((this.x - 1) * _gap_w, 
                   (this.y - 1) * _gap_h, 
                   this.w * _gap_w, 
                   this.h * _gap_h);

    //draw ^ ontop
    ctx.fillStyle = 'rgb(0, 180, 0)';
    let _x = (this.x - 3 + this.w) * _gap_w;
    let _y = (this.y - 1) * _gap_h;
    ctx.fillRect(_x, _y, _gap_w, _gap_h);

    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = Math.floor(_gap_h * 0.75) + "px Arial";
    ctx.fillStyle = 'rgb(0, 0, 0)';//"rgb(0,180,0)";
    ctx.fillText('^', _x + _gap_w/2, _y + _gap_h/2);

    //draw X remove
    ctx.fillStyle = 'rgb(0, 255, 0)';
    ctx.fillRect(_x + _gap_w, _y, _gap_w, _gap_h);
    
    ctx.fillStyle = 'rgb(0, 0, 0)';//"rgb(0,180,0)";
    ctx.fillText('x', _x + _gap_w + _gap_w/2, _y + _gap_h/2);
    

    //draw _ hide
    ctx.fillStyle = 'rgb(0, 180, 0)';
    ctx.fillRect(_x + _gap_w, _y + _gap_h, _gap_w, _gap_h);
    
    ctx.fillStyle = 'rgb(0, 0, 0)';//"rgb(0,180,0)";
    ctx.fillText('_', _x + _gap_w + _gap_w/2, _y + _gap_h + _gap_h/2);
    
  }

  onTop() {
    this.elm.parentNode.appendChild(this.elm);
  }

  getPos() {
    let _gap_w = canvas.width/GRID_W;
    let _gap_h = canvas.height/GRID_H;
    return [(this.x - 1) * _gap_w, (this.y - 1) * _gap_h];
  }

}
</script>
<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" charset="UTF-8"/>
  <!--meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8"/-->
  <!-- |1|2|3|4|5|6|7|8| -->
  <!-- 1-2-3-4-5-6-7-8-9 -->
  <style>
  body {
    margin: 0px;
    height: 100%;
    width: 100%;
    background-color: rgb(0, 255, 0);
  }
  ::-webkit-scrollbar {
    display: none;
  }
  .wrapper {
    display: grid;
    gap: 0px;
    
    grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
    grid-template-rows:    1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;

    width: 100%;
    height: 100vh;
  }
  .full {
    
    grid-column: 1 / 33;
    grid-row: 1 / 33;

    user-select: none;

    /*-webkit-user-select: none;*/ /* Chrome/Safari */ 
    /*-moz-user-select: none; *//* Firefox */
    /* -ms-user-select: none; *//* IE10+ */

    /* The rule below is not implemented in browsers yet */
    /* -o-user-select: none; */

    /* The rule below is implemented in most browsers by now */

  }
  input[type=text] {
        border:2px solid rgb(0, 128, 0);
        border-radius: 2px;
        margin: 2% 2%;
        outline: none;
        padding: 0px;
        box-sizing: border-box;
        background: rgb(0, 150, 0);
        color: rgb(0, 255, 0);
        width: 96%;
      }
  input[type=text]:focus {
    border:2px solid;
    border-color: rgb(0, 255, 0);
    box-shadow: 0 0 8px 0 rgb(0, 255, 0);
    background: rgb(0, 150, 0);
    color: rgb(0, 255, 0);    
  }
  .okbutton {
        font-size: 24px;
        background-color: rgb(0, 150, 0);
        color: #00ff00;
        margin: 2% 2%;
        width:96%;
        border: 2px solid;
        vertical-align: middle;
      }
  </style>
</head>
<body>

<div class="wrapper" style="background-color: #007000; opacity: 1.0;">

    <iframe class="full" id="frame_clock" frameborder="0" width="100%" height="100%" align="left" src="clock.html"></iframe>
    <iframe class="full" id="frame_song" frameborder="0" width="100%" height="100%" align="left" src="subtitle.html"></iframe>
    <iframe class="full" id="frame_Bible" frameborder="0" width="100%" height="100%" align="left" src="subtitle_b.html"></iframe>
    <iframe class="full" id="frame_news" frameborder="0" width="100%" height="100%" align="left" src="marquee_v.html"></iframe>
    <!--iframe class="full" id="frame_effect" frameborder="0" width="100%" height="100%" align="right" src="effect.html"></iframe-->

    <div class="full" id="div_slide" style="background-color: green;margin: 0px;opacity: 1.0;">
      <iframe id="frame_slide" src="" hidden="true" frameborder="0" width="100%" height="100%" allowfullscreen="false" mozallowfullscreen="false" webkitallowfullscreen="false"></iframe>
      <div id="div_input" class="content" style="background-color: green;margin: 0px;opacity: 1.0;">
        <br/>
        <input type="text" id="ppt_url" name="input_url" value="" 
          style="box-shadow: 0px 0px 0px #00ff00;border:1px solid #00ff00;color: #00ff00;background-color: green;margin: 10px;opacity: 1.0;" 
          placeholder="" />
          <script type="text/javascript" charset="UTF-8">
            document.getElementById("ppt_url").value = '';//'https://www.youtube.com/embed/LzS_Mw0bnaw';
            document.getElementById("ppt_url").select();
            function slideGo() {

              let value = document.getElementById("ppt_url").value;//String.fromCodePoint(0x1F604);
              if (value.length == 0) return;
              let elementSub = document.getElementById('frame_slide');
              elementSub.hidden = false;
              elementSub.src = value;
              document.getElementById('div_input').hidden = true;
            }
          </script>
        <br/>
        <button class="okbutton" type="button" onclick="slideGo()">OK</button>
      </div>
      
    </div>

    

    <div id="content_control" class="full" style="background-color: rgb(255, 255, 255);margin: 0px;opacity: 0.33;">
      <canvas id="canvas" width="100" height="100"></canvas>
    </div>
    
</div>

</body>
</html>

<script type="text/javascript" charset="UTF-8">

var canvas;
var ctx;
var keylock = false;
var selectIdx = -1;
var mouseDown = -1;
var mouseDownPos;

var applets = null;

function init() {

    let div = document.getElementById("content_control");
    div.hidden = false;
    div.style.gridColumn =  '1 / ' + (GRID_W + 1)//' '2 / 4';
    div.style.gridRow = '1 / ' + (GRID_H + 1);//'1 / 8';
    
    canvas = document.getElementById("canvas");
    canvas.width  = div.clientWidth;
    canvas.height = div.clientHeight;

    ctx = canvas.getContext("2d");

    div.hidden = true;
    
    if (applets == null) {
      initContent();      
    }

}

function _repaint() {
    
    let gap_w = canvas.width/GRID_W;
    let gap_h = canvas.height/GRID_H;

    for (let i = 0;i<GRID_W;i++) {
      for (let j = 0;j<GRID_H;j++) {
        if ((i + j) % 2 == 0)
          ctx.fillStyle = "rgba(50, 50, 50, 1.0)";
        else 
          ctx.fillStyle = "rgba(0, 0, 0, 1.0)";
        ctx.fillRect(i * gap_w, j * gap_h, gap_w, gap_h);
      }    
    }
    if (selectIdx >= 0) {
      applets[selectIdx].drawSelRect();
    }

    debugDraw();
}

var dx = 0;
var dy = 0;
var dw = 0;
var dh = 0;
function debugSet(_dx, _dy, _dw, _dh) {
  dx = _dx;
  dy = _dy;
  dw = _dw;
  dh = _dh;
}
function debugDraw() {
  ctx.fillStyle = "rgba(255, 255, 0, 1.0)";
  ctx.fillRect(dx, dy, dw, dh);
}

function receiveMessage(e) {
  
  for (let i=0;i<applets.length;i++) {
    applets[i].elm.contentWindow.postMessage(e.data, '/');
  }

  //if (document.getElementById("frame_song").contentWindow) document.getElementById("frame_song").contentWindow.postMessage(e.data, '/');

    _repaint();
}
   
  // 監聽 message 事件
window.addEventListener('message', receiveMessage, false);

window.addEventListener('keyup', function(e) {
  if (e.keyCode == 16) {// || e.keyCode == 17 || e.keyCode == 18 || e.keyCode == 91) {
    keylock = false;
    let div = document.getElementById("content_control");
    div.hidden = true;
    mouseDown = -1;
    selectIdx = -1;
  }
  
  _repaint();
}, false);
window.addEventListener('keydown', function(e) {

  //e.preventDefault();
  //e.stopPropagation();
  if (e.keyCode == 16) {// || e.keyCode == 17 || e.keyCode == 18 || e.keyCode == 91) {
    keylock = true;
    let div = document.getElementById("content_control");
    div.hidden = false;
  }

  _repaint();

}, false);

var mouseX;
var mouseY;

init();
_repaint();

window.addEventListener('resize', function(){
  
  //let div = document.getElementById("content_control");
  //div.hidden = false;
  init();
  //div.hidden = true;

});
canvas.addEventListener('mousemove', e => {

    mouseX = e.x;
    mouseY = e.y;
    
    if (mouseDown < 0) {
      selectIdx = -1;
      for (let i=0;i<applets.length;i++) {
        if (//!applets[i].isHide() && 
        applets[i].checkInside(mouseX, mouseY)) {
          selectIdx = i;
          break;
        }
      }
      _repaint();
      return;
    }

    if (selectIdx < 0) return;

    let _gap_w = canvas.width/GRID_W;
    let _gap_h = canvas.height/GRID_H;

    let applet = applets[selectIdx];
    let pos = applet.getPos();
    
    let _px = pos[0] + mouseX - mouseDownPos[0];
    let _py = pos[1] + mouseY - mouseDownPos[1];

    //move
    let _x = Math.floor((_px + _gap_w/2)/_gap_w) + 1;//Math.ceil(_px/_gap_w);
    let _y = Math.floor((_py + _gap_h/2)/_gap_h) + 1;//Math.ceil(_py/_gap_h);
    
    switch(mouseDown) {
      case 0:
        if (_x != applet.x || _y != applet.y) {
          if (applet.moveBody(_x, _y)) {
            mouseDownPos = [mouseX, mouseY];
          }
        }
        break;
      case 1:
        if (_x != applet.x) {
          if (applet.moveX_(_x)) {
            mouseDownPos = [mouseX, mouseY];
          }
        }
        break;
      case 2:
        _px =  pos[0] + applet.w * _gap_w + mouseX - mouseDownPos[0];
        _x = Math.floor((_px + _gap_w/2)/_gap_w) + 1;
        if (_x != applet.x + applet.w) {
          if (applet.move_X(_x)) {
            mouseDownPos = [mouseX, mouseY];
          }
        }
        break;
      case 3:
        if (_y != applet.y) {
          if (applet.moveY_(_y)) {
            mouseDownPos = [mouseX, mouseY];
          }
        }
        break;
      case 4:
        _py = pos[1] + applet.h * _gap_h + mouseY - mouseDownPos[1];
        _y = Math.floor((_py + _gap_h/2)/_gap_h) + 1;
        if (_y != applet.y + applet.h) {
          if (applet.move_Y(_y)) {
            mouseDownPos = [mouseX, mouseY];
          }
        }
        break;
    }

    //debugSet(_px, _py, applet.w * _gap_w, applet.h * _gap_h);

    _repaint();
    return true;

    //document.getElementById('frame_clock').className = "left";

});

canvas.addEventListener('mousedown', (e) =>{
  
  mouseDownPos = [e.x, e.y];
  
  if (selectIdx >= 0) {

    mouseDown = 0;
    
    let _gap_w = canvas.width/GRID_W;
    let _gap_h = canvas.height/GRID_H;

    let applet = applets[selectIdx];
    let pos = applet.getPos();

    if (applet.isClickHide(mouseX, mouseY)) {
      if (applet.isHide()) 
        applet.showSelf();
      else 
        applet.hideSelf();
      return;
    } else if (applet.isClickRemove(mouseX, mouseY)) {
      applets.splice(selectIdx, 1);
      applet.removeSelf();
      selectIdx = -1;
      _repaint();
      return;      
    } else if (applet.isClickOntop(mouseX, mouseY)) {
      //applet.enlargeSelf();
      applet.onTop();
      _repaint();
      return;
    }

    
    if (applets[selectIdx].check_L_Edge(mouseX)) {
      mouseDown = 1;
      return;
    } 
    if (applets[selectIdx].check_R_Edge(mouseX)) {
      mouseDown = 2;
      return;
    }

    if (applets[selectIdx].check_T_Edge(mouseY)) {
      mouseDown = 3;
      return;
    } 
    if (applets[selectIdx].check_B_Edge(mouseY)) {
      mouseDown = 4;
      return;
    }

  }
  
});
canvas.addEventListener('mouseup', () =>{
  mouseDown = -1;
  return true;
});


</script>